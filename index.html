<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NEP Result Calculator (with Grace)</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
<style>
body { font-family: Arial, sans-serif; background:#f7f9fb; padding:10px; margin:0; }
h1 { text-align:center; font-size:1.4em; margin-bottom:5px; }
h2 { font-size:1em; margin-top:15px; margin-bottom:8px; cursor:pointer; }
.description { text-align:center; margin-bottom:10px; font-size:0.9em; font-weight:bold; }
.owner { text-align:center; font-size:0.85em; margin-bottom:15px; }
.owner b { color:red; font-size:1em; }
.owner small { font-size:0.75em; display:block; }
.subject-section { margin-bottom:15px; border:1px solid #ccc; border-radius:5px; padding:10px; background:#fff; }
.subject { margin-bottom:8px; display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
.subject label { min-width:120px; font-weight:bold; margin-bottom:0; }
.subject input[type=number] { width:45px; text-align:center; }
button { padding:6px 12px; margin:5px 5px 5px 0; cursor:pointer; background:#007BFF; color:#fff; border:none; border-radius:5px; font-size:0.85em; transition:0.3s; }
button:hover { background:#0056b3; transform:scale(1.05); }
table { width:100%; border-collapse: collapse; margin-top:15px; font-size:0.85em; }
thead { background:#f0f0f0; }
th, td { border:1px solid #ccc; padding:6px; text-align:center; }
.pass { color:green; font-weight:bold; }
.fail { color:red; font-weight:bold; }
.grace { color:red; font-weight:bold; }
.graceApplied { background:#fff0f0; } 
#overall { font-size:1.1em; text-align:center; margin-top:10px; font-weight:bold; }
#note { margin-top:20px; font-size:0.8em; text-align:center; color:#333; }
@media(max-width:600px){
  .subject input[type=number] { width:40px; }
  table { font-size:0.75em; }
  th, td { padding:4px; }
}
</style>
</head>
<body>

<h1>NEP Result Calculator (with Grace)</h1>
<div class="description">
Only for NEP BA, B.Sc, B.Com Students <br><br>
यह CCS University Meerut की कोई अधिकारिक साईट/ऐप नहीं है। केवल एनईपी 
रिजल्ट में Grace Marks की गणना करने के लिये व्यक्तिगत रूप से बनाया गया है। 
यह केवल सूचना मात्र के लिये है। रिजल्ट गणना में त्रुटि सम्भव है।
</div>

<div class="owner">
CCS University Meerut & SSV College Hapur Updates <br>
Join Telegram Channel: <a href="https://t.me/ccsnewsupdates" target="_blank">t.me/ccsnewsupdates</a><br>
<b>Sanjeev Chauhan</b> <small>Owner</small>
</div>

<div class="owner">
CCS University Meerut & Other Colleges Updates <br>
Join Telegram Channel: <a href="https://t.me/CCSUniversityMRT" target="_blank">t.me/CCSUniversityMRT</a><br>
<b>Aaditya Chaudhary</b> <small>Owner</small>
</div>

<!-- Semester Selection -->
<div class="subject-section">
<h2>Select Semester</h2>
<select id="semester" onchange="semesterChange()">
  <option value="">--Select Semester--</option>
  <option value="1">1st Semester</option>
  <option value="2">2nd Semester</option>
  <option value="3">3rd Semester</option>
  <option value="4">4th Semester</option>
  <option value="5">5th Semester</option>
  <option value="6">6th Semester</option>
</select>
</div>

<!-- Major Theory -->
<div class="subject-section">
<h2>Major Theory Subjects</h2>
<div id="majorTheorySubjects"></div>
<button onclick="addMajorTheory()">Add Major Theory</button>
</div>

<!-- Major Practical -->
<div class="subject-section">
<h2>Major Practical Subjects</h2>
<div id="majorPracticalSubjects"></div>
<button onclick="addMajorPractical()">Add Major Practical</button>
</div>

<!-- Minor -->
<div class="subject-section" id="minorSection">
<h2>Minor Subjects</h2>
<div id="minorSubjects"></div>
<button onclick="addMinor()">Add Minor Subject</button>
</div>

<!-- Skill -->
<div class="subject-section" id="skillSection">
<h2>Skill Development</h2>
<div id="skillSubjects"></div>
<button onclick="addSkill()">Add Skill Development</button>
</div>

<!-- Co-Curricular -->
<div class="subject-section">
<h2>Co-Curricular</h2>
<div class="subject">
<label>Co-Curricular:</label>
EXT <input type="number" min="0" max="99" class="coExternal">
INT <input type="number" min="0" max="99" class="coInternal">
</div>
</div>

<!-- Project -->
<div class="subject-section" id="projectSection" style="display:none;">
<h2>Project</h2>
<div id="projectSubjects"></div>
<button onclick="addProject()">Add Project</button>
</div>

<!-- Action Buttons -->
<div style="text-align:center; margin-top:10px;">
<button onclick="calculateResult()">Calculate Result</button>
<button onclick="resetForm()">Reset</button>
<button onclick="downloadPDF()">Download Grade Card (PDF)</button>
</div>

<!-- Result Table -->
<div id="gradeCard">
<table id="resultTable">
<thead>
<tr>
<th>Subject</th>
<th>External</th>
<th>Grace</th>
<th>External after Grace</th>
<th>Internal</th>
<th>Total</th>
<th>Status</th>
<th>Marks Short of Pass</th>
</tr>
</thead>
<tbody></tbody>
</table>
<div id="overall"></div>
<div id="note">This result is only for information purpose. Not valid to use for Admission or other activities</div>
</div>

<script>
let majorTheoryCount=0, majorPracticalCount=0, minorCount=0, skillCount=0, projectCount=0;
const maxGrace=5, maxGraceSubjects=3;

// default 3 major theory
for(let i=0;i<3;i++) addMajorTheory();

function semesterChange(){
  let sem=document.getElementById("semester").value;
  if(sem==="5" || sem==="6"){
    document.getElementById("minorSection").style.display="none";
    document.getElementById("skillSection").style.display="none";
  } else {
    document.getElementById("minorSection").style.display="block";
    document.getElementById("skillSection").style.display="block";
  }
  if(sem==="6"){
    document.getElementById("projectSection").style.display="block";
  } else {
    document.getElementById("projectSection").style.display="none";
  }
}

function addSubject(containerId,name,extClass,intClass,label1="EXT",label2="INT"){
  const container=document.getElementById(containerId);
  container.style.display="block";
  const div=document.createElement("div");
  div.className="subject";
  div.innerHTML=`<label>${name}:</label>
  ${label1} <input type="number" class="${extClass}" min="0" max="99">`+
  (intClass?` ${label2} <input type="number" class="${intClass}" min="0" max="99">`:"");
  container.appendChild(div);
}

function addMajorTheory(){ majorTheoryCount++; addSubject("majorTheorySubjects","Major Theory "+majorTheoryCount,"majorTheoryExternal","majorTheoryInternal"); }
function addMajorPractical(){ majorPracticalCount++; addSubject("majorPracticalSubjects","Major Practical "+majorPracticalCount,"majorPracticalExternal","majorPracticalInternal"); }
function addMinor(){ minorCount++; addSubject("minorSubjects","Minor "+minorCount,"minorExternal","minorInternal"); }
function addSkill(){ skillCount++; addSubject("skillSubjects","Skill Development "+skillCount,"skillTheory","skillPractical","TH","PR"); }
function addProject(){ projectCount++; addSubject("projectSubjects","Project "+projectCount,"projectMarks",null,"Total",""); }

function calculateResult(){
  const majors=document.querySelectorAll(".majorTheoryExternal");
  const majorInternals=document.querySelectorAll(".majorTheoryInternal");
  const coExt=document.querySelector(".coExternal").value;
  const coInt=document.querySelector(".coInternal").value;
  let mandatoryOk=true;

  if(majors.length<3){ mandatoryOk=false; }
  else {
    for(let i=0;i<3;i++){
      if((majors[i].value==="" || majorInternals[i].value==="")) mandatoryOk=false;
    }
  }
  if(coExt==="" || coInt==="") mandatoryOk=false;
  if(!mandatoryOk){ alert("Plz Enter Marks of All Subjects"); return; }

  const tbody=document.querySelector("#resultTable tbody");
  tbody.innerHTML="";
  let graceLeft=maxGrace, remainingGraceSubjects=maxGraceSubjects;
  let subjects=[];

  [
    ["majorTheoryExternal","majorTheoryInternal","majorTheory","Major Theory"],
    ["majorPracticalExternal","majorPracticalInternal","majorPractical","Major Practical"],
    ["minorExternal","minorInternal","minor","Minor"],
    ["skillTheory","skillPractical","skill","Skill Development"],
    ["projectMarks",null,"project","Project"]
  ].forEach(([extClass,intClass,type,displayName])=>{
    const extInputs=document.querySelectorAll("."+extClass);
    const intInputs=intClass?document.querySelectorAll("."+intClass):[];
    extInputs.forEach((el,i)=>{
      const ext=Number(el.value)||0;
      const intr=intClass?Number(intInputs[i].value)||0:0;
      if(ext!==0 || intr!==0){
        subjects.push({name:`${displayName} ${i+1}`,ext,internal:intr,type,grace:0, initialPass:false});
      }
    });
  });

  // Co-curricular
  const coE=Number(document.querySelector(".coExternal").value)||0;
  const coI=Number(document.querySelector(".coInternal").value)||0;
  if(coE || coI) subjects.push({name:"Co-Curricular",ext:coE,internal:coI,type:"coCurricular",grace:0,initialPass:false});

  function checkPass(subj,extTotal){
    const total=subj.internal+extTotal;
    if(subj.type==="majorTheory"||subj.type==="minor"||subj.type==="majorPractical") return (extTotal>=25 && total>=33);
    if(subj.type==="skill"||subj.type==="coCurricular"||subj.type==="project") return total>=40;
    return false;
  }

  subjects.forEach(subj=>{ subj.initialPass = checkPass(subj,subj.ext); });

  subjects.forEach(subj=>{
    if(graceLeft<=0 || remainingGraceSubjects<=0) return;
    let total=subj.ext+subj.internal;
    let needGrace=0;
    if(subj.type==="majorTheory"||subj.type==="minor"||subj.type==="majorPractical"){
      if(subj.ext<25){ needGrace=25-subj.ext; }
      if(needGrace===0 && total<33 && subj.ext>=25){ needGrace=33-total; }
    } else if(subj.type==="skill"||subj.type==="coCurricular"||subj.type==="project"){
      if(total<40){ needGrace=40-total; }
    }
    if(needGrace>0){
      const applied=Math.min(needGrace,graceLeft,maxGrace);
      subj.ext+=applied; subj.grace+=applied;
      graceLeft-=applied; remainingGraceSubjects--;
    }
  });

  let anyFailAfterGrace=false;
  subjects.forEach(subj=>{ if(!checkPass(subj,subj.ext)) anyFailAfterGrace=true; });

  subjects.forEach(subj=>{
    const total=subj.ext+subj.internal;
    let status=checkPass(subj,subj.ext)?"Pass":"Fail";
    if(subj.initialPass && subj.grace===0) status="Pass";
    if(anyFailAfterGrace && !subj.initialPass && subj.grace>0) status="Fail";
    let short=0;
    if(status==="Fail"){
      if(subj.type==="majorTheory"||subj.type==="minor"||subj.type==="majorPractical"){
        short=Math.max(0,33-total,25-(subj.ext-subj.grace));
      } else { short=Math.max(0,40-total); }
    }
    const tr=document.createElement("tr");
    tr.className=subj.grace>0?"graceApplied":"";
    tr.innerHTML=`<td>${subj.name}</td>
    <td>${subj.ext-subj.grace}</td>
    <td class="grace">${subj.grace}</td>
    <td>${subj.ext}</td>
    <td>${subj.internal}</td>
    <td>${total}</td>
    <td class="${status==='Pass'?'pass':'fail'}">${status}</td>
    <td>${short>0?short:0}</td>`;
    tbody.appendChild(tr);
  });

  const failMessage='Fail (ग्रेस मिलने के बाद भी यदि किसी भी विषय में बैक रहती है तो किसी भी विषय में ग्रेस नहीं मिलेगा)';
  document.getElementById("overall").innerHTML=anyFailAfterGrace
    ? `Overall Result: <span class="fail">${failMessage}</span>`
    : `Overall Result: <span class="pass">PASS</span>`;
}

function resetForm(){ location.reload(); }

function downloadPDF(){
  const element=document.getElementById("gradeCard");
  const opt={
    margin:0.5,
    filename:'GradeCard.pdf',
    image:{type:'jpeg',quality:0.98},
    html2canvas:{scale:2},
    jsPDF:{unit:'in',format:'a4',orientation:'portrait'}
  };
  html2pdf().set(opt).from(element).save();
}
</script>
</body>
</html>
